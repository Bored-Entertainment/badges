name: Badges
'on':
  push:
    branches:
      - main
jobs:
  create-bored-day-badge:
      name: Create Bored Day Badge
      runs-on: ubuntu-latest
      steps:
        - name: Checkout ðŸ›Žï¸
          uses: actions/checkout@v2
          with:
            persist-credentials: false
        
        - name: Sigin to git
          run: |
            git config --local user.email "action@github.com"
            git config --local user.name "GitHub Action"
            
        - name: Fetch API Data ðŸ“¦
          run: curl https://data.jsdelivr.com/v1/package/gh/pisaucer/boredhtml/stats/version/day > day.json
          
        - name: Read Data From Json ðŸ“š
          id: read-data
          uses: notiz-dev/github-action-json-property@release
          with: 
            path: 'day.json'
            prop_path: 'total'
            
        - name: Remove old Badge
          run: |
            git rm bored/day.svg
            git commit -m "remove bored/day.svg"
            
        - name: Generate the badge SVG image
          uses: emibcn/badge-action@v1
          id: badge
          with:
            label: 'cdn.boredht.ml'
            status: ${{ steps.read-data.outputs.prop }} hits/today
            color: 'yellow'
            path: ./bored/day.svg
            
        - name: Upload badge as artifact
          uses: actions/upload-artifact@v2
          with:
            name: badge
            path: ./bored/day.svg
            if-no-files-found: error

        - name: Extract branch name
          shell: bash
          run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
          id: extract_branch
          
        - name: Commit badge
          env:
            BADGE: ./bored/day.svg
          run: |
            git add "${BADGE}"
            git commit -m "Bored Update Daily Badge"
            
        - name: Push badge commit
          uses: ad-m/github-push-action@master
          with:
            github_token: ${{ secrets.GITHUB_TOKEN }}
            branch: ${{ steps.extract_branch.outputs.branch }}
  create-bored-monthly-badge:
    needs: create-bored-day-badge
    name: Create Bored Monthly Badge
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ›Žï¸
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Sigin to git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git pull

      - name: Fetch API Data ðŸ“¦
        run: curl https://data.jsdelivr.com/v1/package/gh/pisaucer/boredhtml/stats/version/month > month.json

      - name: Read Data From Json ðŸ“š
        id: read-data
        uses: notiz-dev/github-action-json-property@release
        with: 
          path: 'month.json'
          prop_path: 'total'

      - name: Remove old Badge
        run: |
          git rm bored/month.svg
          git commit -m "remove bored/month.svg"

      - name: Generate the badge SVG image
        uses: emibcn/badge-action@v1
        id: badge
        with:
          label: 'cdn.boredht.ml'
          status: ${{ steps.read-data.outputs.prop }} hits/today
          color: 'yellow'
          path: ./bored/month.svg
          
      - name: Extract branch name
        shell: bash
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch
          
      - name: Commit badge
        env:
          BADGE: ./bored/month.svg
        run: |
          git add "${BADGE}"
          git commit -m "Bored Update Monthly Badge"
            
      - name: Push badge commit
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ steps.extract_branch.outputs.branch }}
            
  create-bored-weekly-badge:
    needs: create-bored-monthly-badge
    name: Create Bored Weekly Badge
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ›Žï¸
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Sigin to git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git pull

      - name: Fetch API Data ðŸ“¦
        run: curl https://data.jsdelivr.com/v1/package/gh/pisaucer/boredhtml/stats/version/week > week.json

      - name: Read Data From Json ðŸ“š
        id: read-data
        uses: notiz-dev/github-action-json-property@release
        with: 
          path: 'week.json'
          prop_path: 'total'

      - name: Remove old Badge
        run: |
          git rm bored/week.svg
          git commit -m "remove bored/week.svg"

      - name: Generate the badge SVG image
        uses: emibcn/badge-action@v1
        id: badge
        with:
          label: 'cdn.boredht.ml'
          status: ${{ steps.read-data.outputs.prop }} hits/today
          color: 'yellow'
          path: ./bored/week.svg
          
      - name: Extract branch name
        shell: bash
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch
          
      - name: Commit badge
        env:
          BADGE: ./bored/week.svg
        run: |
          git add "${BADGE}"
          git commit -m "Bored Update Weekly Badge"
            
      - name: Push badge commit
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ steps.extract_branch.outputs.branch }}
          
  create-bored-year-badge:
    needs: create-bored-weekly-badge
    name: Create Bored Year Badge
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ›Žï¸
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Sigin to git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git pull

      - name: Fetch API Data ðŸ“¦
        run: curl https://data.jsdelivr.com/v1/package/gh/pisaucer/boredhtml/stats/version/year > year.json

      - name: Read Data From Json ðŸ“š
        id: read-data
        uses: notiz-dev/github-action-json-property@release
        with: 
          path: 'year.json'
          prop_path: 'total'

      - name: Remove old Badge
        run: |
          git rm bored/year.svg
          git commit -m "remove bored/year.svg"

      - name: Generate the badge SVG image
        uses: emibcn/badge-action@v1
        id: badge
        with:
          label: 'cdn.boredht.ml'
          status: ${{ steps.read-data.outputs.prop }} hits/today
          color: 'yellow'
          path: ./bored/year.svg
          
      - name: Extract branch name
        shell: bash
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch
          
      - name: Commit badge
        env:
          BADGE: ./bored/year.svg
        run: |
          git add "${BADGE}"
          git commit -m "Bored Update Year Badge"
            
      - name: Push badge commit
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ steps.extract_branch.outputs.branch }}
  create-school-day-badge:
      name: Create School Day Badge
      needs: create-bored-year-badge
      runs-on: ubuntu-latest
      steps:
        - name: Checkout ðŸ›Žï¸
          uses: actions/checkout@v2
          with:
            persist-credentials: false
        
        - name: Sigin to git
          run: |
            git config --local user.email "action@github.com"
            git config --local user.name "GitHub Action"
            git pull
            
        - name: Fetch API Data ðŸ“¦
          run: curl https://data.jsdelivr.com/v1/package/gh/Bored-Entertainment/Schoolgrounds/stats/version/day > day.json
          
        - name: Read Data From Json ðŸ“š
          id: read-data
          uses: notiz-dev/github-action-json-property@release
          with: 
            path: 'day.json'
            prop_path: 'total'
            
        - name: Remove old Badge
          run: |
            git rm school/day.svg
            git commit -m "remove school/day.svg"
            
        - name: Generate the badge SVG image
          uses: emibcn/badge-action@v1
          id: badge
          with:
            label: 'cdn.schgnd.ml'
            status: ${{ steps.read-data.outputs.prop }} hits/today
            color: 'orange'
            path: ./school/day.svg
            
        - name: Upload badge as artifact
          uses: actions/upload-artifact@v2
          with:
            name: badge
            path: ./school/day.svg
            if-no-files-found: error

        - name: Extract branch name
          shell: bash
          run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
          id: extract_branch
          
        - name: Commit badge
          env:
            BADGE: ./school/day.svg
          run: |
            git add "${BADGE}"
            git commit -m "School Update Daily Badge"
            
        - name: Push badge commit
          uses: ad-m/github-push-action@master
          with:
            github_token: ${{ secrets.GITHUB_TOKEN }}
            branch: ${{ steps.extract_branch.outputs.branch }}
  create-school-monthly-badge:
    needs: create-school-day-badge
    name: Create Monthly Badge
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ›Žï¸
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Sigin to git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git pull
      - name: Fetch API Data ðŸ“¦
        run: curl https://data.jsdelivr.com/v1/package/gh/Bored-Entertainment/Schoolgrounds/stats/version/month > month.json

      - name: Read Data From Json ðŸ“š
        id: read-data
        uses: notiz-dev/github-action-json-property@release
        with: 
          path: 'month.json'
          prop_path: 'total'

      - name: Remove old Badge
        run: |
          git rm school/month.svg
          git commit -m "remove school/month.svg"
      - name: Generate the badge SVG image
        uses: emibcn/badge-action@v1
        id: badge
        with:
          label: 'cdn.schgnd.ml'
          status: ${{ steps.read-data.outputs.prop }} hits/today
          color: 'orange'
          path: ./school/month.svg
          
      - name: Extract branch name
        shell: bash
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch
          
      - name: Commit badge
        env:
          BADGE: ./school/month.svg
        run: |
          git add "${BADGE}"
          git commit -m "School Update Monthly Badge"
            
      - name: Push badge commit
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ steps.extract_branch.outputs.branch }}
            
  create-school-weekly-badge:
    needs: create-school-monthly-badge
    name: Create Weekly Badge
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ›Žï¸
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Sigin to git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git pull
      - name: Fetch API Data ðŸ“¦
        run: curl https://data.jsdelivr.com/v1/package/gh/Bored-Entertainment/Schoolgrounds/stats/version/week > week.json

      - name: Read Data From Json ðŸ“š
        id: read-data
        uses: notiz-dev/github-action-json-property@release
        with: 
          path: 'week.json'
          prop_path: 'total'

      - name: Remove old Badge
        run: |
          git rm school/week.svg
          git commit -m "remove school/week.svg"
      - name: Generate the badge SVG image
        uses: emibcn/badge-action@v1
        id: badge
        with:
          label: 'cdn.schgnd.ml'
          status: ${{ steps.read-data.outputs.prop }} hits/today
          color: 'orange'
          path: ./school/week.svg
          
      - name: Extract branch name
        shell: bash
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch
          
      - name: Commit badge
        env:
          BADGE: ./school/week.svg
        run: |
          git add "${BADGE}"
          git commit -m "School Update Weekly Badge"
            
      - name: Push badge commit
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ steps.extract_branch.outputs.branch }}
          
  create-school-year-badge:
    needs: create-school-weekly-badge
    name: Create Year Badge
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ›Žï¸
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Sigin to git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git pull
      - name: Fetch API Data ðŸ“¦
        run: curl https://data.jsdelivr.com/v1/package/gh/Bored-Entertainment/Schoolgrounds/stats/version/year > year.json

      - name: Read Data From Json ðŸ“š
        id: read-data
        uses: notiz-dev/github-action-json-property@release
        with: 
          path: 'year.json'
          prop_path: 'total'

      - name: Remove old Badge
        run: |
          git rm school/year.svg
          git commit -m "remove school/year.svg"
      - name: Generate the badge SVG image
        uses: emibcn/badge-action@v1
        id: badge
        with:
          label: 'cdn.schgnd.ml'
          status: ${{ steps.read-data.outputs.prop }} hits/today
          color: 'orange'
          path: ./school/year.svg
          
      - name: Extract branch name
        shell: bash
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch
          
      - name: Commit badge
        env:
          BADGE: ./school/year.svg
        run: |
          git add "${BADGE}"
          git commit -m "School Update Year Badge"
            
      - name: Push badge commit
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ steps.extract_branch.outputs.branch }}
   
  loc:
    needs: create-school-year-badge
    name: Line of Code
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ›Žï¸
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Sigin to git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git pull

      - name: Remove old Badges
        run: |
          git rm bored/loc.svg
          git commit -m "remove bored/loc.svg"
          git rm school/loc.svg
          git commit -m "remove school/loc.svg"

      - name: install tokei
        run: "cargo install --git https://github.com/XAMPPRocky/tokei.git tokei"

      - name: cloning boredhtml
        run: "git clone https://github.com/PiSaucer/boredhtml.git"

      - name: cloning schoolgroudns
        run: "git clone https://github.com/Bored-Entertainment/Schoolgrounds.git"

      - name: Bored tokei 
        run: tokei boredhtml --output json > bored.json
      - run: cat bored.json

      - name: School tokei 
        run: tokei Schoolgrounds --output json > school.json
      - run: cat school.json

      - name: Read Bored Data From Json
        id: bored-read-data
        uses: notiz-dev/github-action-json-property@release
        with: 
          path: 'bored.json'
          prop_path: 'Total.code'

      - name: Read School Data From Json
        id: school-read-data
        uses: notiz-dev/github-action-json-property@release
        with: 
          path: 'school.json'
          prop_path: 'Total.code'

      - name: Generate the school badge SVG image
        uses: emibcn/badge-action@v1
        id: school-badge
        with:
          label: 'total lines'
          status: ${{ steps.school-read-data.outputs.prop }}
          color: 'orange'
          path: ./school/loc.svg

      - name: Generate the bored badge SVG image
        uses: emibcn/badge-action@v1
        id: bored-badge
        with:
          label: 'total lines'
          status: echo ${{ steps.bored-read-data.outputs.prop }} | sed ':a;s/\B[0-9]\{3\}\>/,&/;ta'
          color: 'yellow'
          path: ./bored/loc.svg

      - name: Upload bored badge as artifact
        uses: actions/upload-artifact@v2
        with:
          name: bored-badge
          path: ./bored/loc.svg
          if-no-files-found: error

      - name: Upload school badge as artifact
        uses: actions/upload-artifact@v2
        with:
          name: school-badge
          path: ./school/loc.svg
          if-no-files-found: error

      - name: Extract branch name
        shell: bash
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch

      - name: Commit bored badge
        env:
          BORED_BADGE: ./bored/loc.svg
        run: |
          git add "${BORED_BADGE}"
          git commit -m "Bored Update LOC Badge"

      - name: Commit school badge
        env:
          SCHOOL_BADGE: ./school/loc.svg
        run: |
          git add "${SCHOOL_BADGE}"
          git commit -m "School Update LOC Badge"

      - name: Push badge commit
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ steps.extract_branch.outputs.branch }}
