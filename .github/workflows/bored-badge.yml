name: Bored Badges
'on':
  push:
    branches:
      - main
jobs:
  create-day-badge:
      name: Create Day Badge
      runs-on: ubuntu-latest
      steps:
        - name: Checkout ðŸ›Žï¸
          uses: actions/checkout@v2
          with:
            persist-credentials: false
        
        - name: Sigin to git
          run: |
            git config --local user.email "action@github.com"
            git config --local user.name "GitHub Action"
            
        - name: Fetch API Data ðŸ“¦
          run: curl https://data.jsdelivr.com/v1/package/gh/pisaucer/boredhtml/stats/version/day > day.json
          
        - name: Read Data From Json ðŸ“š
          id: read-data
          uses: notiz-dev/github-action-json-property@release
          with: 
            path: 'day.json'
            prop_path: 'total'
            
        - name: Remove old Badge
          run: |
            git rm bored/day.svg
            git commit -m "remove bored/day.svg"
            
        - name: Generate the badge SVG image
          uses: emibcn/badge-action@v1
          id: badge
          with:
            label: 'cdn.boredht.ml'
            status: ${{ steps.read-data.outputs.prop }} hits/today
            color: 'yellow'
            path: ./bored/day.svg
            
        - name: Upload badge as artifact
          uses: actions/upload-artifact@v2
          with:
            name: badge
            path: ./bored/day.svg
            if-no-files-found: error

        - name: Extract branch name
          shell: bash
          run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
          id: extract_branch
          
        - name: Commit badge
          env:
            BADGE: ./bored/day.svg
          run: |
            git add "${BADGE}"
            git commit -m "Bored Update Daily Badge"
            
        - name: Push badge commit
          uses: ad-m/github-push-action@master
          with:
            github_token: ${{ secrets.GITHUB_TOKEN }}
            branch: ${{ steps.extract_branch.outputs.branch }}
  create-monthly-badge:
    needs: create-day-badge
    name: Create Monthly Badge
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ›Žï¸
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Sigin to git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git pull

      - name: Fetch API Data ðŸ“¦
        run: curl https://data.jsdelivr.com/v1/package/gh/pisaucer/boredhtml/stats/version/month > month.json

      - name: Read Data From Json ðŸ“š
        id: read-data
        uses: notiz-dev/github-action-json-property@release
        with: 
          path: 'month.json'
          prop_path: 'total'

      - name: Remove old Badge
        run: |
          git rm bored/month.svg
          git commit -m "remove bored/month.svg"

      - name: Generate the badge SVG image
        uses: emibcn/badge-action@v1
        id: badge
        with:
          label: 'cdn.boredht.ml'
          status: ${{ steps.read-data.outputs.prop }} hits/today
          color: 'yellow'
          path: ./bored/month.svg
          
      - name: Extract branch name
        shell: bash
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch
          
      - name: Commit badge
        env:
          BADGE: ./bored/month.svg
        run: |
          git add "${BADGE}"
          git commit -m "Bored Update Monthly Badge"
            
      - name: Push badge commit
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ steps.extract_branch.outputs.branch }}
            
  create-weekly-badge:
    needs: create-monthly-badge
    name: Create Weekly Badge
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ›Žï¸
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Sigin to git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git pull

      - name: Fetch API Data ðŸ“¦
        run: curl https://data.jsdelivr.com/v1/package/gh/pisaucer/boredhtml/stats/version/week > week.json

      - name: Read Data From Json ðŸ“š
        id: read-data
        uses: notiz-dev/github-action-json-property@release
        with: 
          path: 'week.json'
          prop_path: 'total'

      - name: Remove old Badge
        run: |
          git rm bored/week.svg
          git commit -m "remove bored/week.svg"

      - name: Generate the badge SVG image
        uses: emibcn/badge-action@v1
        id: badge
        with:
          label: 'cdn.boredht.ml'
          status: ${{ steps.read-data.outputs.prop }} hits/today
          color: 'yellow'
          path: ./bored/week.svg
          
      - name: Extract branch name
        shell: bash
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch
          
      - name: Commit badge
        env:
          BADGE: ./bored/week.svg
        run: |
          git add "${BADGE}"
          git commit -m "Bored Update Weekly Badge"
            
      - name: Push badge commit
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ steps.extract_branch.outputs.branch }}
          
  create-year-badge:
    needs: create-weekly-badge
    name: Create Year Badge
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ›Žï¸
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Sigin to git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git pull

      - name: Fetch API Data ðŸ“¦
        run: curl https://data.jsdelivr.com/v1/package/gh/pisaucer/boredhtml/stats/version/year > year.json

      - name: Read Data From Json ðŸ“š
        id: read-data
        uses: notiz-dev/github-action-json-property@release
        with: 
          path: 'year.json'
          prop_path: 'total'

      - name: Remove old Badge
        run: |
          git rm bored/year.svg
          git commit -m "remove bored/year.svg"

      - name: Generate the badge SVG image
        uses: emibcn/badge-action@v1
        id: badge
        with:
          label: 'cdn.boredht.ml'
          status: ${{ steps.read-data.outputs.prop }} hits/today
          color: 'yellow'
          path: ./bored/year.svg
          
      - name: Extract branch name
        shell: bash
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch
          
      - name: Commit badge
        env:
          BADGE: ./bored/year.svg
        run: |
          git add "${BADGE}"
          git commit -m "Bored Update Year Badge"
            
      - name: Push badge commit
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ steps.extract_branch.outputs.branch }}
          
  loc:
    needs: create-year-badge
    runs-on: ubuntu-latest
    name: Line of Code
    steps:
      - name: Checkout ðŸ›Žï¸
        uses: actions/checkout@v2
        with:
          persist-credentials: false
      
      - name: Sigin to git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git pull
      
      - name: Remove old Badge
        run: |
          git rm bored/loc.svg
          git commit -m "remove bored/loc.svg"
      
      - name: install tokei
        run: "cargo install --git https://github.com/XAMPPRocky/tokei.git tokei"
        
      - name: cloning boredhtml
        run: "git clone https://github.com/PiSaucer/boredhtml.git"

      - name: tokei 
        run: tokei boredhtml --output json > loc.json
      - run: cat loc.json
      
      - name: Read Data From Json
        id: read-data
        uses: notiz-dev/github-action-json-property@release
        with: 
          path: 'loc.json'
          prop_path: 'Total.code'
            
      - name: Generate the badge SVG image
        uses: emibcn/badge-action@v1
        id: badge
        with:
          label: 'total lines'
          status: ${{ steps.read-data.outputs.prop }}
          color: 'yellow'
          path: ./bored/loc.svg

      - name: Upload badge as artifact
        uses: actions/upload-artifact@v2
        with:
          name: badge
          path: ./bored/loc.svg
          if-no-files-found: error

      - name: Extract branch name
        shell: bash
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch
        
      - name: Commit badge
        env:
          BADGE: ./bored/loc.svg
        run: |
          git add "${BADGE}"
          git commit -m "Bored Update LOC Badge"
          
      - name: Push badge commit
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ steps.extract_branch.outputs.branch }}
